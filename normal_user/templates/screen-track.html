{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>{% trans "Employee track window" %}</title>

    <!-- Custom fonts for this template-->
    <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

    <link
    href="https://fonts.googleapis.com/css?family=Oswald:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="{% static 'css/sb-admin-2.css' %}" rel="stylesheet">

</head>

<body class="alert-page" id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <div class="container-fluid">

            <div class="row">
                <div class="col-12">
                    <div class="overlay-btm py-4 d-flex align-items-end justify-content-end">
                        <div class="screen-track">
                            <div class="header-bar p-3 border-bottom d-flex">
                                <div class="logo-part d-flex">
                                    <a href="#" title=""><img class="mr-2 mr-md-3 mr-lg-3"
                                        src="{% static 'images/logo-large-2.jpg' %}" title="Blue Logo"
                                        alt="Blue Logo"></a>
                                        <!-- <h3 class="align-items-center mr-1">Team Connect: </h3> -->
                                        <h3 class="text-blk">{{user_details.name}}</h3>
                                    </div>
                                </div>

                                <div class="body-part fixed-part-body p-3 p-md-3 p-lg-3">
                                    <div class="time-block d-flex mb-4">
                                        <div class="alert-btn-wrap mr-auto">
                                            <div class="time-text-font" id="countdown_timer">{{countdown_timer}}</div>
                                        </div>
                                        <div class="time-wrap ml-auto">
                                            <div class="day-wrap">
                                                <a class="ml-2 today_status">{% if shift_ended or countdown_timer == '0:00' %}{% trans "Offline" %} <i class="fas fa-circle red-color"></i>{% else %}{% trans "Online" %} <i class="fas fa-circle light-green-color"></i>{% endif %}</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="select-bar">
                                        <div class="form-group">
                                            <select class="form-control form-control-lg" id="user_status" {% if shift_ended %}disabled{% endif %}>
                                                <option value="i_am_here">{% trans "I am here" %}</option>
                                                <option value="in_meeting">{% trans "In meeting" %}</option>
                                                <option value="lunch_break">{% trans "Lunch Break" %}</option>
                                                <option value="tea_break">{% trans "Tea break" %}</option>
                                                <option value="offline" {% if shift_ended or countdown_timer == '0:00' %}selected{% endif %}>{% trans "Offline" %}</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="task-status-wrap d-flex">
                                        <div class="alt-block mr-2 mr-md-3 mr-lg-3 class_alert_button_div_div {% if alert_obj.alert %}class_alert_button_div{% endif %}" id="alert_button_div" {% if alert_obj.alert %}attr="{{alert_obj.alert_message}}"{% endif %}>
                                        <button type="button"
                                        class="btn removable_class btn-primary {% if alert_obj.alert %}bg-red{% endif %} bg-gray alert m-0" id="removable_class_alert">{% trans "Alert" %}</button>
                                    </div>

                                    <div class="icons-wrapper ml-2 d-flex">
                                        <span id="open_task_icon">
                                            <a href="#" class="icon-wrap mr-2 mr-md-2 mr-lg-2 bg-green"
                                            data-toggle="tooltip" data-placement="top" title="{% trans "Task" %}" id="task_a">
                                            <img src="{% static 'img/task-icon.png' %}" alt="task-icon"
                                            id="task_image">
                                            {% if tasks_count %}
                                            <span class="badge badge-danger badge-counter">{{tasks_count}}</span>
                                            {% endif %}
                                        </a>
                                    </span>


                                    <span id="open_status">
                                        <a href="#" class="icon-wrap mr-2 mr-md-2 mr-lg-2 bg-blue icon-noty"
                                        data-toggle="tooltip" data-placement="top" title="{% trans "Status" %}">
                                        <i class="fas fa-thermometer-three-quarters"></i>
                                    </a>
                                </span>

                                <span id="open_email_icon">
                                    <a href="#" class="icon-wrap bg-gray icon-noty" data-toggle="tooltip"
                                    data-placement="top" title="{% trans "Email" %}" id="email_a">
                                    <i id="email_image" class="far fa-envelope"></i>
                                    {% if email_count %}
                                    <span class="badge badge-danger badge-counter">{{email_count}}</span>
                                    {% endif %}
                                </a>
                            </span>

                        </div>
                    </div>
                </div>
                <div class="footer-wrap border-top p-2 d-flex">
                    <div class="message-wrap ml-auto">
                        <span id="open-resource">
                            <a class="mr-2 mr-md-3 mr-lg-3 diff-noty" data-toggle="tooltip"
                            data-placement="top" title="{% trans "Resource" %}">
                            <i class="fas fa-clipboard-list"></i>
                        </a>
                    </span>
                    <button class="d-sm-inline-block btn btn-sm btn-primary table-btn shadow-sm" id="complete" onclick="complete" {% if shift_ended %}disabled{% endif %}>{% trans "Completed" %}</button>
                    <button class="d-sm-inline-block btn btn-sm btn-primary table-btn shadow-sm" id="i_am_here_button" {% if shift_ended %}disabled{% endif %}>{% trans "I am here" %}</button>
                    <button class="d-sm-inline-block btn btn-sm btn-primary table-btn shadow-sm" id="i_am_here_butt" data-toggle="modal" data-target="#end_shift_modal" {% if shift_ended %}disabled{% endif %}>{% trans "End Shift" %}</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>

</div>

<!--Alert  Modal-->
<div class="adjust-clock alert modal" id="alert" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Alert Window" %} </h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <!-- <div class="close-btn br-red"> -->
                        <span aria-hidden="true">
                           x <!-- <img src="{% static 'img/speaker.png' %}" alt=""> -->
                       </span>
                   </div>
               </button>
           </div>
           <div class="modal-body p-3 p-md-4 p-lg-4">
            <div class="row form-row">
                <div class="col-lg-12 text-center">
                    <div class="img-bell mb-2">
                        <img src="{% static 'img/bell.png' %}" alt="Notification">
                    </div>
                    <h3 class="m-0 mb-md-1">{% trans "Manager" %}</h3>
                    <p class="m-0" id="alert_message"></p>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn w-100 btn-sm btn-primary sbt-btn" type="button"
            id="acknowledge_alert"> {% trans "Acknowledge" %} </button>
        </div>
    </div>
</div>
</div>

<!-- Task1 Modal-->
<div class="adjust-clock alert task modal" id="task1" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true" style="overflow-y: auto;">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Task Window" %} </h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body p-3 p-md-4 p-lg-4">
            <div class="row form-row">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label>{% trans "Task" %}</label>
                        <input type="text" class="form-control"
                        placeholder="{% trans "Lorem Ipsum is simply dummy text" %}" required>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group m-0">
                        <label>{% trans "Today Task" %}</label>
                        <textarea type="text" class="form-control"
                        placeholder="Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industr..."></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn w-100 btn-sm btn-success" type="button"
            data-dismiss="modal"> {% trans "Acknowledge" %} </button>
        </div>
    </div>
</div>
</div>

<!-- Task2 tabular-form Modal-->
<div class="adjust-clock alert task modal" id="task2" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true" style="overflow-y: auto;">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Task List" %} </h5>
            <div class="d-flex ml-auto">
                <!-- <div class="date-text-font l-h">3/6/2020</div> -->
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <div class="close-btn">
                        <span aria-hidden="true">×</span>
                    </div>
                </button>
            </div>
        </div>
         <div class="modal-body p-3 p-md-4 p-lg-4">
            <div class="row form-row">
                <div class="table-responsive-sm">
                    <table class="table table-bordered" id="table_task" cellspacing="0" width="100%">
                        <tr class="border-bottom-2">
                            <th>{% trans "Serial No." %}</th>
                            <th>{% trans "Task" %}</th>
                            <th>{% trans "Date" %}</th>
                            <th> <a href="#" class="ack-icon" data-toggle="tooltip" data-placement="top"
                                title="{% trans "Acknowledge" %}"> <i class="fa fa-check-circle"
                                aria-hidden="true"></i>
                            </a></th>
                            <th> <a href="#" class="ack-icon" data-toggle="tooltip" data-placement="top"
                                title="{% trans "complete" %}"> <i class="fa fa-check-circle"
                                aria-hidden="true"></i>
                            </a>

                          </th>
                        </tr>
                        {% if not tasks %}
                        <tr>
                            <td colspan="4">{% trans "No data found" %}</td>
                        </tr>
                        {% else %}
                        {% for i in tasks %}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td colspan="3">
                              <table class="inner-table child-table"> 
                                <tr>
                                    <td> {{i.task}}</td>
                                    <td>{{i.created}}</td>
                                    
                                    <td>
                                        <div class="button1">
                                        <a class="acknowledge_status_btn ack-icon" data-toggle="tooltip"
                                        data-placement="top" title="{% trans "Acknowledge" %}">
                                        <i class="fa fa-check-circle" aria-hidden="true"></i>
                                        </a>
                                        </div>
                                    </td> 
                                   
                                    <td>
                                         <div class="button2">
                                        <a class="complete ack-icon" data-toggle="tooltip" 
                                        data-placement="top" title="{% trans "complete" %}">
                                        <i class="fa fa-check-circle" aria-hidden="true"></i>
                                        </a>
                                        </div>
                                    </td> 
                                </tr>
                               </table>

                            </td>
                        <!-- <td>{{i.created}}</td>
                        <td>
                            <a class="acknowledge_status_btn ack-icon" data-toggle="tooltip"
                            data-placement="top" title="Acknowledge">
                            <i class="fa fa-check-circle" aria-hidden="true"></i>
                        </a>
                    </td> -->
                </tr>
                {% endfor %}
                {% endif %}
            </table>
        </div>
    </div>
</div>
</div>
</div>
</div>

<!-- Status Modal-->
<div class="adjust-clock alert task modal" id="status" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Status Window" %} </h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body p-3 p-md-4 p-lg-4">
            <div class="row form-row">
                <div class="col-lg-12">
                    <div class="mb-2 text-center">
                        <div class="time-text-font text-primary mb-1 mb-lg-2 status_time" id=""></div>
                        <div class="date-text-font" id="status_date"></div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group m-0">
                        <label> {% trans "Status" %}</label>
                        <textarea type="text" class="form-control staff_status_ff" placeholder="{% trans "Update Your status" %}..."
                        id="staff_status" onkeyup="staff_status_error_fn()"></textarea>
                        <span id="staff_status_error" style="display: none;color: red;"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn w-100 btn-sm btn-primary bg-status" type="button"
            id="update_status"> {% trans "OK" %}</button>
        </div>
    </div>
</div>
</div>

<!-- Resource Modal-->
<div class="adjust-clock alert task modal" id="resource" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Resource Window" %} </h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body py-0 px-2 px-md-2 px-lg-2" id="appendable_resource">


        </div>
                <!--  <div class="modal-footer border-top-0">
                <button class="d-sm-inline-block btn w-100 btn-sm btn-primary bg-status" type="button"
                    data-dismiss="modal" id="update_status"> OK </button>
                </div> -->
            </div>
        </div>
    </div>

    <!-- track-email Modal-->
    <div class="adjust-clock alert task modal" id="track-email" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel" aria-hidden="true" style="overflow-y: auto;">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header flex-row align-items-center justify-content-between">
                <h5 class="modal-title" id="exampleModalLabel">{% trans "Email List" %} </h5>
                <div class="d-flex ml-auto">
                    <!-- <div class="date-text-font l-h">3/6/2020</div> -->
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <div class="close-btn">
                            <span aria-hidden="true">×</span>
                        </div>
                    </button>
                </div>
            </div>
            <div class="modal-body p-3 p-md-4 p-lg-4">
                <div class="row form-row">
                    <div class="table-responsive-sm">
                        <table class="table table-bordered" cellspacing="0" width="100%" id="email_table">
                            <tr class="border-bottom-2">
                                <th>{% trans "Serial No." %}</th>
                                <th>{% trans "Subject" %}</th>
                                <th>{% trans "Description" %} </th>
                                <th><a href="#" class="ack-icon" data-toggle="tooltip" data-placement="top"
                                    title="{% trans "Acknowledge" %}"><i class="fa fa-check-circle"
                                    aria-hidden="true"></i>
                                </a></th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Reply  popup -->
<div class="adjust-clock task add-dce manager-alert modal fade" id="email_reply_modal" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Email Reply" %} </h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body p-3 p-md-4 p-lg-4">
            <div class="row form-row">
                <div class="col-lg-12">
                    <div class="form-group m-0">
                        <input type="text" class="form-control" name="email_reply" id="email_reply_text" onkeyup="email_reply_validation()">
                        <label id="email_reply_text_error" style="display: none; color: red;"></label>               
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" id="send_reply_email_btn" type="button"> {% trans "Send" %} </button>
            <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn brown-clr shadow-sm"
            type="button" data-dismiss="modal"> {% trans "Close" %} </button>
        </div>
    </div>
</div>
</div>

<!-- alert msg popup -->
<div class="submit-msg alert modal fade" id="alert_popup" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body">
            <div class="row form-row">
                <div class="col-lg-12 text-center">
                    <p class="m-4">{% trans "Any alert massege" %}</p>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" type="button"
            data-dismiss="modal"> {% trans "Ok" %} </button>
        </div>
    </div>
</div>
</div>


<div class="submit-msg alert modal fade" id="universal_msg_modal" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body">
            <div class="row form-row">
                <div class="col-lg-12 text-center">
                    <p class="m-0" id="universal_msg"></p>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" type="button" data-dismiss="modal"> {% trans "Ok" %} </button>
        </div>
    </div>
</div>
</div>


<div class="submit-msg alert modal fade" id="end_shift_modal" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body">
            <div class="row form-row">
                <div class="col-lg-12 text-center">
                    <p class="m-0" >{% trans "Are you sure you want to end your shift ?" %}</p>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" id="end_shift_btn"> {% trans "Ok" %} </button>
            <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" type="button" data-dismiss="modal"> {% trans "Cancel" %} </button>
        </div>
    </div>
</div>
</div>

<!-- Manager  Comment Modal-->
<div class="adjust-clock task manager-email comment modal" id="staff-comment" tabindex="-1" role="dialog"
aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header flex-row align-items-center justify-content-between">
            <h5 class="modal-title" id="exampleModalLabel">{% trans "Comment to:" %} <span
                class="mr-2 d-lg-inline font-weight-bold text-black1 small word-style">Jacob
            Watts</span> </h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <div class="close-btn">
                    <span aria-hidden="true">×</span>
                </div>
            </button>
        </div>
        <div class="modal-body p-3 p-md-4 p-lg-4">
            <div class="row form-row">
                <div class="col-lg-12">
                    <div class="form-group m-0">
                        <label>Comment</label>
                        <textarea type="text" class="form-control" id="user-comment"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer border-top-0">
            <button class="d-sm-inline-block btn btn-sm btn-primary px-5" type="button" data-dismiss="modal"
            data-attr=""> ok </button>
        </div>
    </div>
</div>
</div>

<audio id="audiotag1" src="{% static 'swiftly.mp3' %}" preload="auto"></audio>
<!-- loader -->
<div class="loader-overlay" id="page_loader" style="display: none;">
  <div class="spinner-border text-primary" role="status">
        <span class="sr-only">{% trans "Loading..." %}</span>
    </div>
</div>

<input type="button" name="" style="display: none;" id="focus_button">

<!-- Bootstrap core JavaScript-->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- Core plugin JavaScript-->
<script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
<!-- Custom scripts for all pages-->
<script src="{% static 'js/sb-admin-2.js' %}"></script>
<script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>
<script src="https://momentjs.com/downloads/moment-timezone-with-data.js"></script>
<script type="text/javascript">


    setInterval(function(){ 
        user_status = $("#user_status option:selected").val()
        $.ajax({
          type: 'POST',
          url: "{% url 'staff_online' %}",
          data: {
            "user_status" : user_status,
            "user_id" : "{{request.user.id}}",
        },
        success: function(response){
        }
    });
    }, 60000);
</script>

{% if not shift_ended %}
<script type="text/javascript">
    console.log(window)
    $("#user_status option[value='i_am_here']").attr('disabled', true);
    $("#i_am_here_button").attr('disabled', true);
    var off_interval;
    var time = "{{countdown_timer}}";
        if(time == "0:00"){
            $("#user_status option[value='i_am_here']").attr('disabled', false);
    $("#i_am_here_button").attr('disabled', false);

        }
        else{
                var interval = setInterval(function() {
                var timer = time.split(':');
                //by parsing integer, I avoid all extra string processing
                var minutes = parseInt(timer[0], 10);
                var seconds = parseInt(timer[1], 10);
                --seconds;
                minutes = (seconds < 0) ? --minutes : minutes;
                if (minutes < 0) clearInterval(interval);
                seconds = (seconds < 0) ? 59 : seconds;
                seconds = (seconds < 10) ? '0' + seconds : seconds;
                //minutes = (minutes < 10) ?  minutes : minutes;
                $('#countdown_timer').html(minutes + ':' + seconds);
                time = minutes + ':' + seconds;
                if(time == "0:10" || time == "0:09" || time == "0:08" || time == "0:07" || time == "0:06" || time == "0:05" || time == "0:04" || time == "0:03" || time == "0:02" || time == "0:01"){
                    $("#user_status option[value='i_am_here']").attr('disabled', false);
                    $("#i_am_here_button").attr('disabled', false);
                }
                if(time == "0:00"){
                    $("#focus_button").click()

                    $("#user_status option[value='i_am_here']").attr('disabled', false);
                    $("#i_am_here_button").attr('disabled', false);
                    clearInterval(interval)
                    clearInterval(off_interval)
                    window.off_interval = setTimeout(function(){
                        change_user_status1("offline")
                        $("#user_status option[value='offline']").attr('selected', false);
                        $("#user_status option[value='offline']").attr('selected', true);
                        $(".today_status").html('{% trans "Offline" %} <i class="fas fa-circle red-color"></i>')
                    }, 10000);
                }               
            }, 1000);
        }
    </script>
    {% endif %}

    <script> 

        function download_file(fileURL, fileName) {
            // for non-IE
            if (!window.ActiveXObject) {
                var save = document.createElement('a');
                save.href = fileURL;
                save.target = '_blank';
                var filename = fileURL.substring(fileURL.lastIndexOf('/')+1);
                save.download = fileName || filename;
                if ( navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/) && navigator.userAgent.search("Chrome") < 0) {
                    document.location = save.href; 
                // window event not working here
            }else{
              var evt = new MouseEvent('click', {
                  'view': window,
                  'bubbles': true,
                  'cancelable': false
              });
              save.dispatchEvent(evt);
              (window.URL || window.webkitURL).revokeObjectURL(save.href);
          } 
      }

              // for IE < 11
              else if ( !! window.ActiveXObject && document.execCommand)     {
                  var _window = window.open(fileURL, '_blank');
                  _window.document.close();
                  _window.document.execCommand('SaveAs', true, fileName || fileURL)
                  _window.close();
              }
          }

          $(document).on('click', '.dwnload-resource', function(){
            download_file($(this).attr("data-href"), $(this).attr("data-title"));
        })


        // data-toggle="modal" data-target="#status"

        $("#open_status").click(function(){
            $("#status").modal("show")
            $("#staff_status").val("")
            $("#staff_status_error").hide()
        })

        $("#i_am_here_button").click(function(){
            clearInterval(interval1)
            clearInterval(interval)
            clearInterval(window.off_interval2)
            clearInterval(window.off_interval)
            $("#user_status").val('i_am_here').trigger('change');
        })



        var interval1;
        var off_interval2;
        $("#user_status").change(function () {
            if($("#user_status option:selected").val() == "i_am_here"){
                $("#user_status option[value='i_am_here']").attr('disabled', true);
                $("#i_am_here_button").attr('disabled', true);
                change_user_status1("i_am_here")
                $(".today_status").html('{% trans "Online" %} <i class="fas fa-circle light-green-color"></i>')
                var times = "{{i_am_here_countdown_timer}}";
                // var times = "0:10";
                clearInterval(interval1)
                clearInterval(window.off_interval2)
                clearInterval(window.off_interval)
                window.interval1 = setInterval(function() {
                    var timers = times.split(':');
                    //by parsing integer, I avoid all extra string processing
                    var minutes = parseInt(timers[0], 10);
                    var seconds = parseInt(timers[1], 10);
                    --seconds;
                    minutes = (seconds < 0) ? --minutes : minutes;
                    if (minutes < 0) clearInterval(window.interval1);
                    seconds = (seconds < 0) ? 59 : seconds;
                    seconds = (seconds < 10) ? '0' + seconds : seconds;
                    //minutes = (minutes < 10) ?  minutes : minutes;
                    $('#countdown_timer').html(minutes + ':' + seconds);
                    times = minutes + ':' + seconds;
                    if(times == "0:10" || times == "0:09" || times == "0:08" || times == "0:07" || times == "0:06" || times == "0:05" || times == "0:04" || times == "0:03" || times == "0:02" || times == "0:01"){
                        $("#user_status option[value='i_am_here']").attr('disabled', false);
                        $("#i_am_here_button").attr('disabled', false);
                    }
                    if(times == "0:00"){
                        $("#focus_button").click()
                        $("#user_status option[value='i_am_here']").attr('disabled', false);
                        $("#i_am_here_button").attr('disabled', false);
                        clearInterval(window.interval1)                            
                        clearInterval(window.off_interval2)
                        clearInterval(window.off_interval)
                        window.off_interval2 = setTimeout(function(){
                            change_user_status1("offline")
                            $("#user_status option[value='offline']").attr('selected', false);
                            $("#user_status option[value='offline']").attr('selected', true);
                            $(".today_status").html('{% trans "Offline" %} <i class="fas fa-circle red-color"></i>')
                        }, 10000);
                    }        
                }, 1000);
            }
            else{
                $("#user_status option[value='i_am_here']").attr('disabled', false);
                $("#i_am_here_button").attr('disabled', false);
                if($("#user_status option:selected").val() == "in_meeting"){
                    $(".today_status").html('{% trans "In Meeting" %} <i class="fas fa-circle orange-color"></i>')
                }
                if($("#user_status option:selected").val() == "lunch_break"){
                    $(".today_status").html('{% trans "Lunch Break" %} <i class="fas fa-circle orange-color"></i>')
                }
                if($("#user_status option:selected").val() == "tea_break"){
                    $(".today_status").html('{% trans "Tea Break" %} <i class="fas fa-circle orange-color"></i>')
                }
                if($("#user_status option:selected").val() == "offline"){
                    $(".today_status").html('{% trans "Offline" %} <i class="fas fa-circle red-color"></i>')
                }
                clearInterval(window.off_interval2)
                clearInterval(window.interval1)
                clearInterval(window.interval)
                clearInterval(window.off_interval)
                $('#countdown_timer').html("0:00");
                change_user_status()         
            }
        })


$("#open-resource").click(function(){
    user_id = "{{request.user.id}}"
    $.ajax({
        type: "POST",
        url: "{% url 'open_resource' %}",
        data: {
            "user_id" : user_id
        },
        success: function (response) {
                        // $("#page_loader").hide()
                        if(response == 0){
                            $("#universal_msg").html("{% trans "Something went worng" %}")
                            $("#universal_msg_modal").modal("show")
                        }
                        else{
                            response = JSON.parse(response)
                            $("#appendable_resource").html(response)
                            $("#resource").modal("show")
                        }
                    }
                })
})

function email_reply_validation(){
    val = $("#email_reply_text").val()
    if(val == ""){
        $("#email_reply_text_error").html("{% trans "This field is required" %}")
        $("#email_reply_text_error").show()
        return false
    }
    else{
        $("#email_reply_text_error").hide()
        return true
    }
}

$(document).on("click", "#send_reply_email_btn", function(){

    msg_id = $(this).attr("data-attr")
    val = $("#email_reply_text").val()
    email_reply_validation()
    if(email_reply_validation()){
        $("#page_loader").show()
        $.ajax({
            type: "POST",
            url: "{% url 'user_emails' %}",
            data: {
                "msg_id" : msg_id,
                "message" : val
            },
            success: function (response) {
                $("#page_loader").hide()
                if(response == 1){
                    $("#email_reply_modal").modal("hide")
                    $("#user_details").hide()
                    $("#universal_msg").html("{% trans "Message sent successfully" %}")
                    $("#universal_msg_modal").modal("show")
                }
                else{
                   $("#universal_msg").html("{% trans "Something went worng" %}")
                   $("#universal_msg_modal").modal("show")
               }
           }
       })
    }
})

complete

$("#open_task_icon").click(function () {
    $("#page_loader").hide()
    $.ajax({
        type: "POST",
        url: "{% url 'user_tasks' %}",
        data: {
            "user_id": "{{request.user.id}}"
        },
        success: function (response) {
            $("#page_loader").hide()
            // html = '<tr class="border-bottom-2"><th>S.No.</th><th>Task</th><th>Date</th><th>Status</tr>'
            console.log(response)
                html = response
            // try {
            //     response = JSON.parse(response)
                // if(response.length == 0){
                //     html += '<tr><td colspan="4">No data found</td></tr>'
                // }
                // else{

                    // for (var i = 0; i < response.length; i++) {

                    //     console.log(response)

                    //     des = i+1
                    //     task = response[i]['tasks']

                    //     task_split_html = ''

                    //     for(var k=0; k<task.length;k++){
                    //         task_split_html += (k+1).toString()+". "+task[k]["task"] +"<br>"
                    //     }

                    //             // if (!!~task.indexOf(' ,,, ')){
                    //             //     task_split = task.split(" ,,, ")
                    //             //     for(){
                    //             //         task_split_html+= (k+1).toString()+". "+task_split[k]+"<br>"
                    //             //     }
                    //             // }
                    //             // else{
                    //             //     task_split_html = task
                    //             // }

                    //             if(response[i]["acknowledge"] == false){
                    //                 task_html = '<a class="acknowledge_status_btn ack-icon" data-toggle="tooltip" data-placement="top" title="Acknowledge" data-attr="' + response[i]['id'] + '"> <i class="fa fa-check-circle" aria-hidden="true"></i></a>'
                    //             }
                    //             else{
                    //                 task_html = '<a class="ack-icon" data-toggle="tooltip" data-placement="top" title="Acknowledge" >Acknowledged</a>'
                    //             }
                    //             html += '<tr><td>' + des + '</td><td>' + task_split_html + '</td><td>' + response[i]['date_str'] + '</td><td>'+ task_html  +'</td></tr>'
                    //         }
                    //     }
                    // }
                    // catch(err){
                    //     html += '<tr><td colspan="4">No data found</td></tr>'
                    // }
                    $("#table_task").html(html)
                    $("#task_image").next("span").remove()
                    $("#task2").modal("show")
                }
            })
})

$(document).on("click", ".send_email_reply", function () {
    $("#email_reply_text").val("")
    $("#send_reply_email_btn").attr("data-attr", $(this).attr("data-attr"))
    $("#email_reply_modal").modal("show")
    $("#email_reply_text_error").hide()
})


$("#open_email_icon").click(function () {
    $("#page_loader").show()
    $.ajax({
        type: "GET",
        url: "{% url 'user_emails' %}",
        data: {
            "user_id": "{{request.user.id}}"
        },
        success: function (response) {

            $("#page_loader").hide()
            html = '<tr class="border-bottom-2"><th>{% trans "Serial No." %}</th><th>{% trans "Subject" %}</th><th>{% trans "Description" %}</th><th><a href="#" class="ack-icon" data-toggle="tooltip" data-placement="top" title="{% trans "Reply" %}">{% trans "Reply" %}</a></th></tr>'
            try {
                response = JSON.parse(response)
                if(response.length == 0){
                    html += '<tr><td colspan="4">{% trans "No data found" %}</td></tr>'
                }
                else{
                    for (var i = 0; i < response.length; i++) {
                        email_ss = i + 1
                        html += '<tr><td>' + email_ss + '</td><td>' + response[i]['subject'] + '</td><td>' + response[i]['descrtiption'] + '</td><td><a  class="ack-icon" data-toggle="tooltip" data-placement="top" title="{% trans "Send Reply" %}"> <i  data-attr="' + response[i]['id'] + '" class="send_email_reply fa fa-check-circle" aria-hidden="true"></i></a></td></tr>'
                    }
                }
            }
            catch(err){
                html += '<tr><td colspan="4">{% trans "No data found" %}</td></tr>'
            }
            $("#email_table").html(html)
            $("#email_image").next("span").remove()
            $("#track-email").modal("show")
        }
    })
})

$(document).on("click", ".acknowledge_status_btn", function () {
    id = $(this).attr('data-attr')
    var that = $(this)
    $.ajax({
        type: "POST",
        url: "{% url 'acknowledge_task' %}",
        data: {
            "user_id": id
        },
        success: function (response) {
            if(response == 1){
                that.html('<a class="ack-icon" data-toggle="tooltip" data-placement="top" title="{% trans "Acknowledge" %}">{% trans "Acknowledged" %}</a>')
                $("#universal_msg").html("{% trans "Task Acknowledged successfully" %}")
                $("#universal_msg_modal").modal("show")
            }
        }
    })
})

$(document).on("click", ".complete_status_btn", function () {
    id = $(this).attr('data-attr')
    var that = $(this)
    $.ajax({
        type: "POST",
        url: "{% url 'acknowledge_task' %}",
        data: {
            "user_id": id
        },
        success: function (response) {
            if(response == 1){
                that.html('<a class="ack-icon" data-toggle="tooltip" data-placement="top" title="{% trans "Complete" %}">{% trans "Complete" %}</a>')
                $("#universal_msg").html("{% trans "Task Complete successfully" %}")
                $("#universal_msg_modal").modal("show")
            }
        }
    })
})


$(document).on("click", ".class_alert_button_div", function () {
    alert_message = $(this).attr("attr")
    if (alert_message){
        $("#alert_message").html(alert_message)
    }
    $("#alert").modal("show")
})


$(document).on("click", ".class_alert_button_div", function () {
    alert_message = $(this).attr("attr")
    if (alert_message){
        $("#alert_message").html(alert_message)
    }
    $("#alert").modal("show")
})


$(document).on('click', ".open_comment_icon", function () {
    $.ajax({
        type: "POST",
        url: "{% url 'user_comment' %}",
        data: {
            "user_id": "{{request.user.id}}"
        },
        success: function (response) {
            $("#comment_span").removeClass("open_comment_icon")
            $("#user-comment").val(response)
            $("#staff-comment").modal("show")
            o = $("#comment_image").next("span")
            o.remove()
        }
    })
})

var loc = window.location
var endpoint = ''
var wsStart = 'ws://'
if (loc.protocol == 'https:') {
    wsStart = 'wss://'
}
var endpoint = wsStart + loc.host + "/channels_url/{{request.user.username}}/"
var socket = new WebSocket(endpoint)

socket.onmessage = function (e) {
    e_data = JSON.parse(e.data)
    e_data = JSON.parse(e_data["data"])
    if (e_data["task_count"] > 0) {

        if (($("#task_image").next("span")).length != 0) {
            $("#task_image").next("span").html(e_data["task_count"].toString())
        }
        else {
            $("#task_a").append('<span class="badge badge-danger badge-counter">' + e_data["task_count"].toString() + '</span>')
        }
    }
    if (e_data["alert_count"] > 0) {

        document.getElementById('audiotag1').play();
        $("#alert_button_div").addClass("class_alert_button_div")
        $("#alert_button_div").html('<button type="button" class="btn removable_class bg-red btn-primary sbt-btn alert m-0" style="color:red;" id="removable_class_alert">Alert</button>')
        $("#alert_message").html(e_data["alert_message"])
    }
    if (e_data["email_count"] > 0) {
        if (($("#email_image").next("span")).length != 0) {
            $("#email_image").next("span").html(e_data["email_count"].toString())
        }
        else {
            $("#email_a").append('<span class="badge badge-danger badge-counter">' + e_data["email_count"].toString() + '</span>')
        }
    }
    if (e_data["comment_count"] > 0) {
        if (($("#comment_image").next("span")).length != 0) {
            $("#comment_image").next("span").html(e_data["comment_count"].toString())
        }
        else {
            $("#comment_a").append('<span class="badge badge-danger badge-counter">' + e_data["comment_count"].toString() + '</span>')
        }
    }
}


socket.onopen = function (e) {
    $("#focus_button").click(function(){
        socket.send(JSON.stringify({"flash_popup": true, "user_id" :"{{request.user.id}}"}))
    })
}
socket.onerror = function (e) {
    console.log("error", e)
}
socket.onclose = function (e) {
    console.log("onclose", e)
}


function change_user_status1(status){
    user_status = status
    $.ajax({
        type: "POST",
        url: "{% url 'user_online_status' %}",
        data: {
            "user_status": user_status
        },
        success: function (response) {                        
        }
    })
}




function change_user_status(){
    user_status = $("#user_status option:selected").val()
    $.ajax({
        type: "POST",
        url: "{% url 'user_online_status' %}",
        data: {
            "user_status": user_status
        },
        success: function (response) {                        
        }
    })
}







        // 100000


        $("#acknowledge_alert").click(function () {
            $("#page_loader").show()
            $.ajax({
                type: "POST",
                url: "{% url 'user_alert' %}",
                data: {
                    "user_id": "{{request.user.id}}"
                },
                success: function (response) {
                    $("#page_loader").hide()
                    $("#alert_button_div").removeClass("class_alert_button_div")
                    $("#alert_message").html(response)
                    $("#alert").modal("hide")
                    
                    $("#removable_class_alert").removeClass()
                    $("#removable_class_alert").addClass("btn removable_class btn-primary bg-gray alert m-0")
                    $("#universal_msg").html("{% trans "Alert Acknowledged" %}")
                    $("#universal_msg_modal").modal("show")
                }
            })

        })

        function run_time_clock() {
            var london = moment.tz("{{user_details.timezone}}").format('h:mm A');

            $(".status_time").html(london)
            $("#status_date").html(moment.tz("{{user_details.timezone}}").format('DD/MM/YYYY'));
        }
        setInterval(run_time_clock, 1000);

        function staff_status_error_fn(){
            status__ = document.getElementById("staff_status").value
            if (status__ == ""){
                $("#staff_status_error").show()
                $("#staff_status_error").html("{% trans "This field is required" %}")
                return false
            }
            else{
                $("#staff_status_error").hide()
                return true   
            }
        }

        $("#update_status").click(function () {
            status__ = document.getElementById("staff_status").value

            staff_status_error_fn()
            // if (status__ == ""){
            //     $("#staff_status").focus()
            //     return false
            // }
            if (staff_status_error_fn()) {
            $("#page_loader").show()
                $.ajax({
                    type: "POST",
                    url: "{% url 'staff_status' %}",
                    data: { "status": status__ },
                    success: function (response) {
                        $("#page_loader").hide()
                        if (response == 1) {
                            document.getElementById("staff_status").value = ""
                            $("#universal_msg").html("{% trans "Status sent successfully" %}")
                            $("#status").modal("hide")
                            $("#universal_msg_modal").modal("show")
                            

                        }
                    }
                })
            }
        })

        $("#end_shift_btn").click(function(){
            $("#i_am_here_button").attr('disabled', true);
            $("#i_am_here_butt").attr('disabled', true);
            
            // change_user_status1("offline")
            $("#user_status option[value='offline']").attr('selected', false);
            $("#user_status option[value='offline']").attr('selected', true);
            $(".today_status").html('Offline <i class="fas fa-circle red-color"></i>')
            $('#countdown_timer').html("0:00");
            clearInterval(window.off_interval2)
            clearInterval(window.interval1)
            clearInterval(window.interval)
            clearInterval(window.off_interval)
            $.ajax({
                type: "POST",
                url: "{% url 'end_shift' %}",
                data: { "user_id": "request.user.id" },
                success: function (response) {
                    $("#end_shift_modal").modal("hide")
                    if (response == 1) {
                        $("#universal_msg").html("{% trans "Your daily shift has been ended" %}")
                        $("#universal_msg_modal").modal("show")
                    }
                    else if (response == 5) {
                        $("#universal_msg").html("{% trans "Your have already end your daily shift" %}")
                        $("#universal_msg_modal").modal("show")
                    }
                    else{
                        $("#universal_msg").html("{% trans "Something went worng" %}")
                        $("#universal_msg_modal").modal("show")
                    }
                }
            })
        })
    </script>
</body>

</html>